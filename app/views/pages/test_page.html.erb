<% p = {} %>
<% p[:people_magazine] = {image: 'people', full_name: 'People', path: '/peoplemagazine'} %>
<% p[:time_magazine] = {image: 'TIME', full_name: 'Time', path: '/timemagazine'} %>
<% p[:wired] = {image: 'wired', full_name: 'Wired', path: '/wired'} %>
<% viewed = {} %>
<% not_viewed = {} %>
<% p.each do |key, val| %>
  <% if Impression.where(action_name: key.to_s, user_id: current_user.id).present? %>
    <% viewed[key] = val %>
  <% else %>
    <% not_viewed[key] = val %>
  <% end %>
<% end %>
<% this_is_it = Hash[viewed.sort_by {|a, b| -Impression.where(action_name: a.to_s, user_id: current_user.id).count}].merge(not_viewed) %>
<div class="Alignthisorelse">
  <div class="container">
    <% this_is_it.each do |key, val| %>
      <div class="row">
        <div class="col-sm-2 col-sm-offset-1 features-box wow fadeInUp">
          <div class="features-box-icon">
            <%= link_to image_tag("#{val[:image]}.jpg", size: "150x150", title: "#{val[:full_name]}"), "#{val[:path]}" %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>