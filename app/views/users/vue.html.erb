<% content_for :for_head do %>
  <title>Vue</title>
<% end %>
<style>
.tab-content {
    border-radius: 0px;
    padding: 0px 30px;
}
</style>

<section id="userarea">
  <%= render partial: "profile_info" %>
</section>
<% if Impression.where(user_id: @user.id, impressionable_type: 'Page').any? %>

    <!-- SWITCHABLE CONTENT -->
    <article class="col-xs-12 tab-content">
      <!-- PANEL THREE -->
      <div id="networks">
        <% all_pages = [] %>
        <% seen_pages = Page.joins(:impressions).where("impressions.user_id = ?",current_user.id).group("pages.id") %>
        <% non_seen_pages = Page.where("id not in (?)", seen_pages.pluck(:id)).order("view_count desc") %>
        <% all_pages << seen_pages  %>
        <% all_pages << non_seen_pages  %>
        <% all_pages.flatten.first(50).each do |page| %>

          <!-- PROFILE -->
          <div class="individual_profile col-xs-6 col-sm-4 col-md-3 col-lg-2">
            <a href="/pages/<%= page.page_name %>">
              <div class="profile-head">
                <p><%= truncate(page.full_name.capitalize, length: 19) %></p>
              </div>
              <%= image_tag(page.profile_pic) %>
            </a>
          </div>
        <% end %>

      </div>
    </article>
<% else %>
<% m = Page.first(20) %>
  <section id="settings" class="container">
    <div class="row">    
      <div class="center col-xs-12 content">
        <h3>Check out some of these pages</h3>
      </div>
      <!-- SWITCHABLE CONTENT -->
      <article class="content col-xs-12 tab-content">
        <!-- PANEL THREE -->
        <div id="networks">
          <% m.each do |page| %>
            <!-- PROFILE -->
            <div class="individual_profile col-xs-6 col-sm-4 col-md-3 col-lg-2">
              <a href="/pages/<%= page.page_name %>">
                <div class="profile-head">
                  <p><%= truncate(page.full_name.capitalize, length: 19) %></p>
                </div>
                <%= image_tag(page.profile_pic) %>
              </a>
            </div>
          <% end %>

        </div>
      </article>
    </div>
  </section>
<% end %>